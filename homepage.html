<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Login - Mental Health Hub</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
           font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            background-attachment: fixed;
            color: #1a2e35;
        }
        .login-card {
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(19, 78, 74, 0.1);
        }
        .login-btn {
            transition: background-color 0.3s, transform 0.1s;
        }
        .login-btn:hover {
            transform: translateY(-1px);
        }

        /* ✨ Floating Animation for Signup Form */
        .float-animation {
            animation: floatIn 0.5s ease forwards;
        }
        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* ✨ Login Form Animation */
        .login-animate {
            opacity: 0;
            transform: translateY(25px);
            animation: loginFade 0.8s ease-out forwards;
        }
        @keyframes loginFade {
            0% { opacity: 0; transform: translateY(25px); }
            100% { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

    <div class="login-card w-full bg-white p-8 sm:p-10 rounded-3xl border border-green-200">

        <!-- Header -->
        <header class="text-center mb-10">
            <h1 id="formTitle" class="text-4xl font-extrabold text-green-700 mb-2">Welcome Back</h1>
            <p id="formSubtitle" class="text-gray-500">Sign in to access your wellness resources.</p>
        </header>

        <!-- LOGIN FORM -->
        <form id="loginForm" class="space-y-6 login-animate">

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                <input id="loginEmail" type="email" required
                    class="w-full p-3 border border-green-300 rounded-xl focus:ring-green-500"
                    placeholder="you@example.com">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input id="loginPassword" type="password" required
                    class="w-full p-3 border border-green-300 rounded-xl focus:ring-green-500"
                    placeholder="••••••••">
            </div>

            <p id="loginError" class="text-red-600 text-sm font-semibold hidden text-center"></p>

            <button type="submit"
                class="login-btn w-full bg-green-600 text-white font-bold py-3 rounded-full shadow-lg hover:bg-green-700">
                Log In
            </button>
        </form>

        <!-- SIGNUP FORM -->
        <form id="signupForm" class="space-y-6 hidden">

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                <input id="signupEmail" type="email" required
                    class="w-full p-3 border border-green-300 rounded-xl focus:ring-green-500"
                    placeholder="you@example.com">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input id="signupPassword" type="password" required
                    class="w-full p-3 border border-green-300 rounded-xl focus:ring-green-500"
                    placeholder="Create password">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                <input id="signupConfirmPassword" type="password" required
                    class="w-full p-3 border border-green-300 rounded-xl focus:ring-green-500"
                    placeholder="Re-enter password">
            </div>

            <p id="signupError" class="text-red-600 text-sm font-semibold hidden text-center"></p>

            <button type="submit"
                class="login-btn w-full bg-green-600 text-white font-bold py-3 rounded-full shadow-lg hover:bg-green-700">
                Sign Up
            </button>
        </form>

        <!-- Toggle -->
        <p class="mt-8 text-center text-gray-600">
            <span id="toggleText">Don't have an account?</span>
            <button id="toggleBtn" class="font-semibold text-indigo-600 hover:text-indigo-800">
                Sign up here
            </button>
        </p>

       
    </div>

<script>
// SHA-256 hashing
async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// Load users
let users = JSON.parse(localStorage.getItem("users")) || [];

// Default admin
const defaultAdminHash = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9";
if (!users.some(u => u.role === "admin")) {
    users.push({ email: "admin@mentalhealthhub.com", passwordHash: defaultAdminHash, role: "admin" });
    localStorage.setItem("users", JSON.stringify(users));
}

const loginForm = document.getElementById("loginForm");
const signupForm = document.getElementById("signupForm");
const toggleBtn = document.getElementById("toggleBtn");
const toggleText = document.getElementById("toggleText");

const loginEmail = document.getElementById("loginEmail");
const loginPassword = document.getElementById("loginPassword");
const loginError = document.getElementById("loginError");

const signupEmail = document.getElementById("signupEmail");
const signupPassword = document.getElementById("signupPassword");
const signupConfirmPassword = document.getElementById("signupConfirmPassword");
const signupError = document.getElementById("signupError");

// LOGIN
loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const hash = await hashPassword(loginPassword.value);
    const user = users.find(u => u.email === loginEmail.value && u.passwordHash === hash);

    if (!user) {
        loginError.textContent = "Sign Up First!";
        loginError.classList.remove("hidden");
        return;
    }

    loginError.classList.add("hidden");

    localStorage.setItem("currentUserEmail", user.email);
    localStorage.setItem("currentUserRole", user.role);

    if (user.role === "admin") {
        window.location.href = "adminlogin.html"; 
    } else {
        window.location.href = "search bar.html";
    }
});

// SIGNUP
signupForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const password = signupPassword.value;
    const strongPassword = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

    if (!strongPassword.test(password)) {
        signupError.textContent = "Your password is not valid! (min 8 characters & must contain letters + numbers)";
        signupError.classList.remove("hidden");
        return;
    }

    if (password !== signupConfirmPassword.value) {
        signupError.textContent = "Passwords do not match!";
        signupError.classList.remove("hidden");
        return;
    }

    if (users.some(u => u.email === signupEmail.value)) {
        signupError.textContent = "This email is already registered!";
        signupError.classList.remove("hidden");
        return;
    }

    const hash = await hashPassword(password);

    users.push({
        email: signupEmail.value,
        passwordHash: hash,
        role: "user"
    });

    localStorage.setItem("users", JSON.stringify(users));

    window.location.href = "search bar.html";
});

// Toggle Forms with Animation
toggleBtn.addEventListener("click", () => {
    signupForm.classList.toggle("hidden");
    loginForm.classList.toggle("hidden");

    if (!signupForm.classList.contains("hidden")) {
        signupForm.classList.add("float-animation");
    }

    if (signupForm.classList.contains("hidden")) {
        toggleBtn.textContent = "Sign up here";
        toggleText.textContent = "Don't have an account?";
    } else {
        toggleBtn.textContent = "Log in here";
        toggleText.textContent = "Already have an account?";
    }
});
</script>

</body>
</html>
